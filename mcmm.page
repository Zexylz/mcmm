Menu="Utilities"
Title="Modpack Manager"
Icon="cubes"
---
<?php
/* Minecraft Modpack Manager for Unraid */

// Debug visibility
@ini_set('display_errors', '1');
@error_reporting(E_ALL);

// Load Config
$plugin = 'mcmm';
// @phpstan-ignore-next-line
$config = parse_plugin_cfg($plugin);
$docroot = $_SERVER['DOCUMENT_ROOT'] ?? '/usr/local/emhttp';

// Include helpers if available
if (file_exists("$docroot/plugins/$plugin/include/helpers.php")) {
    require_once "$docroot/plugins/$plugin/include/helpers.php";
} elseif (file_exists(__DIR__ . '/include/helpers.php')) {
    // Development fallback
    require_once __DIR__ . '/include/helpers.php';
}

// Default config values (mirrored in default.cfg, but good to have fallback)
$defaults = [
    'curseforge_api_key' => '',
    'default_server_name' => 'My Modpack Server',
    'default_port' => 25565,
    'default_memory' => '4G',
    'default_whitelist' => '',
    'default_icon_url' => '',
    'default_pvp' => true,
    'default_hardcore' => false,
    'default_allow_flight' => false,
    'default_command_blocks' => true,
    'default_rolling_logs' => true,
    'default_log_timestamp' => true,
    'default_direct_console' => false,
    'default_aikar_flags' => true,
    'default_meowice_flags' => false,
    'default_graalvm_flags' => false,
    'jvm_flags' => ''
];

$config = array_merge($defaults, $config);

// Helper functions moved to include/helpers.php

$servers = getMinecraftServers();

// Prepare config for JS
$clientConfig = $config;
$clientConfig['has_api_key'] = !empty($clientConfig['curseforge_api_key']);
unset($clientConfig['curseforge_api_key']); // Don't expose key to client logic if not needed, though it is needed for settings form population.
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modpack Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link rel="stylesheet" href="/plugins/mcmm/styles/mcmm.css">
    <style>
        /* Narrower deploy modal override */
        #deployModal .mcmm-modal {
            max-width: 640px !important;
            width: 90% !important;
        }
        div.title {
            display: none !important;
        }
        #displaybox,
        #displaybox .content {
            margin: 0;
            padding: 0;
            max-width: 100% !important;
        }
    </style>
</head>
<body>
<div class="mcmm-app">
    <!-- Debug banner to confirm render -->
    <div id="mcmm-debug-banner" style="position:fixed;top:8px;right:8px;z-index:4000;background:#7c3aed;color:#fff;padding:6px 10px;border-radius:8px;font-weight:700;font-family:Arial, sans-serif;box-shadow:0 4px 12px rgba(0,0,0,0.3);">
        MCMM UI loaded (debug)
    </div>
    <div class="mcmm-bg"></div>

    <!-- Header -->
    <header class="mcmm-header">
        <div class="mcmm-brand">
            <span>‚ö°</span> Modpack Manager
        </div>
        <div class="mcmm-version">v1.0.0</div>
    </header>

    <!-- Tabs -->
    <nav class="mcmm-tabs">
        <a href="#" class="mcmm-tab active" onclick="switchTab('servers', this); return false;">My Servers</a>
        <a href="#" class="mcmm-tab" onclick="switchTab('backups', this); return false;">Backups</a>
        <a href="#" class="mcmm-tab" onclick="switchTab('catalog', this); return false;">Catalog</a>
        <a href="#" class="mcmm-tab" onclick="switchTab('settings', this); return false;">Settings</a>
    </nav>

    <!-- Main Content -->
    <main class="mcmm-main">

        <!-- My Servers Tab -->
        <div id="tab-servers" class="mcmm-tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.25rem;">Servers Status</h2>
                <button class="mcmm-btn mcmm-btn-primary" onclick="switchTab('catalog', document.querySelector('.mcmm-tab:nth-child(2)'))">
                    Deploy New Server
                </button>
            </div>

            <?php if (empty($servers)) : ?>
                <div class="mcmm-empty">
                    <h3>No servers found</h3>
                    <p>Get started by deploying your first modpack server.</p>
                    <button class="mcmm-btn mcmm-btn-primary" onclick="switchTab('catalog', document.querySelector('.mcmm-tab:nth-child(2)'))">Browse Catalog</button>
                </div>
            <?php else : ?>
                <div class="mcmm-server-list" id="serverListContainer">
                    <?php
                    foreach ($servers as $index => $server) :
                        $icon = isset($server['icon']) && $server['icon'] ? $server['icon'] : "https://media.forgecdn.net/avatars/855/527/638260492657788102.png";
                        $ramUsage = isset($server['ram']) ? $server['ram'] : 0;
                        $cpuUsage = isset($server['cpu']) ? $server['cpu'] : 0;
                        $statusClass = $server['isRunning'] ? 'running' : 'stopped';
                        $playersOnline = isset($server['players']['online']) ? intval($server['players']['online']) : 0;
                        $playersMax = isset($server['players']['max']) ? intval($server['players']['max']) : (isset($config['default_max_players']) ? intval($config['default_max_players']) : 0);

                        $ramUsedMb = $server['ramUsedMb'] ?? 0;
                        $ramLimitMb = $server['ramLimitMb'] ?? 0;
                        $ramConfigMb = $server['ramConfigMb'] ?? 0;
                        $ramCapMb = $ramConfigMb > 0 ? $ramConfigMb : ($ramLimitMb > 0 ? $ramLimitMb : 0);
                        $ramPercent = $ramCapMb > 0 ? ($ramUsedMb / $ramCapMb * 100) : $ramUsage;
                        $ramPercent = round($ramPercent, 1);
                        $ramUsedLabel = $ramUsedMb > 0 ? round($ramUsedMb / 1024, 1) . ' GB' : '0 GB';
                        $ramCapLabel = $ramCapMb > 0 ? round($ramCapMb / 1024, 1) . ' GB' : 'N/A';
                        ?>
                        <!-- DEBUG: Icon for <?php echo htmlspecialchars($server['name']); ?>: <?php echo htmlspecialchars($icon); ?> -->
                        <div class="mcmm-server-row <?php echo $statusClass; ?>">
                            <div class="mcmm-server-icon" style="background-image: url('<?php echo htmlspecialchars($icon); ?>');"></div>

                            <div class="mcmm-server-info">
                                <div class="mcmm-server-title"><?php echo htmlspecialchars($server['name']); ?></div>
                                <div class="mcmm-server-subtitle">
                                    <span>Port: <?php echo htmlspecialchars($server['ports']); ?></span>
                                    <span style="opacity:0.5;">|</span>
                                    <span><?php echo $server['isRunning'] ? 'Online' : 'Offline'; ?></span>
                                    <?php if ($server['isRunning']) : ?>
                                        <span style="opacity:0.5;">|</span>
                                        <span id="players-<?php echo $server['id']; ?>" data-server-id="<?php echo $server['id']; ?>" data-port="<?php echo htmlspecialchars($server['ports']); ?>" data-running="<?php echo $server['isRunning'] ? '1' : '0'; ?>">
                                            <?php echo intval($playersOnline); ?> / <?php echo ($playersMax > 0 ? intval($playersMax) : '?'); ?> players
                                        </span>
                                    <?php endif; ?>
                                </div>
                            </div>

                            <div class="mcmm-server-metrics">
                                <div class="mcmm-metric">
                                    <div class="mcmm-metric-label">
                                        <span>RAM</span>
                                        <span><?php echo $ramUsedLabel; ?> / <?php echo $ramCapLabel; ?></span>
                                    </div>
                                    <div class="mcmm-metric-bar">
                                        <div class="mcmm-metric-fill" style="width: <?php echo min(max($ramPercent, 0), 100); ?>%; background: linear-gradient(90deg, #a855f7, #ec4899);"></div>
                                    </div>
                                </div>
                                <div class="mcmm-metric">
                                    <div class="mcmm-metric-label">
                                        <span>CPU</span>
                                        <span><?php echo $cpuUsage; ?>%</span>
                                    </div>
                                    <div class="mcmm-metric-bar">
                                        <div class="mcmm-metric-fill" style="width: <?php echo $cpuUsage; ?>%; background: linear-gradient(90deg, #3b82f6, #06b6d4);"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="mcmm-server-actions">
                                <?php if ($server['isRunning']) : ?>
                                    <button class="mcmm-btn-icon danger" title="Stop Server" onclick="controlServer('<?php echo $server['id']; ?>', 'stop')">‚èπ</button>
                                    <button class="mcmm-btn-icon" title="Console" onclick="openConsole('<?php echo $server['id']; ?>', '<?php echo htmlspecialchars($server['name']); ?>')">_></button>
                                    <button class="mcmm-btn-icon" title="Players" onclick="openPlayersModal('<?php echo $server['id']; ?>', '<?php echo htmlspecialchars($server['name']); ?>', '<?php echo htmlspecialchars($server['ports']); ?>')">üë•</button>
                                <?php else : ?>
                                    <button class="mcmm-btn-icon success" title="Start Server" onclick="controlServer('<?php echo $server['id']; ?>', 'start')">‚ñ∂</button>
                                    <button class="mcmm-btn-icon" style="opacity:0.5; cursor:not-allowed;" title="Console Offline">_></button>
                                    <button class="mcmm-btn-icon" style="opacity:0.5; cursor:not-allowed;" title="Players Offline">üë•</button>
                                <?php endif; ?>
                                <button class="mcmm-btn-icon" title="Mods" onclick="openModManager('<?php echo $server['id']; ?>', '<?php echo htmlspecialchars($server['name']); ?>')">üß©</button>
                                <button class="mcmm-btn-icon" title="Settings" onclick="openServerSettings('<?php echo $server['id']; ?>')">‚öôÔ∏è</button>
                                <button class="mcmm-btn-icon danger" title="Delete Server" onclick="deleteServer('<?php echo $server['id']; ?>')">üóëÔ∏è</button>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
                <div style="margin-top: 1rem;">
                    <button class="mcmm-btn mcmm-btn-primary" onclick="startAgents()">Restart Metrics Agents</button>
                </div>
            <?php endif; ?>
        </div>

        <!-- Backups Tab -->
        <div id="tab-backups" class="mcmm-tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.25rem;">Server Backups</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="mcmm-btn" onclick="loadBackups()">Refresh List</button>
                    <button class="mcmm-btn mcmm-btn-primary" onclick="switchTab('servers', document.querySelector('.mcmm-tab:first-child'))">Create New Backup</button>
                </div>
            </div>
            <div id="backups-list-container">
                <div class="mcmm-empty">
                    <h3>No backups found</h3>
                    <p>Backups you create will appear here. You can reinstall a server to a previous state from these archives.</p>
                </div>
            </div>
        </div>

        <!-- Catalog Tab -->
        <div id="tab-catalog" class="mcmm-tab-content">
            <div class="mcmm-catalog-header">
                <div class="mcmm-search">
                    <span class="mcmm-search-icon">üîç</span>
                    <input type="text" class="mcmm-search-input" placeholder="Search modpacks..." id="modpackSearch" onkeyup="filterModpacks()">
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-left: auto;">
                    <span style="font-size: 0.85rem; color: var(--text-secondary); font-weight: 600;">Fit Images</span>
                    <label class="mcmm-switch">
                        <input type="checkbox" onchange="toggleImageFit(this)">
                        <span class="mcmm-slider"></span>
                    </label>
                </div>
            </div>

            <div class="mcmm-modpack-grid" id="modpackGrid">
                <!-- Loaded via JS -->
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="mcmm-tab-content">
            <div class="mcmm-settings-container">
                <h2 style="font-size: 1.15rem; margin-bottom: 2rem;">Global Settings</h2>

                <div id="settingsStatus" class="mcmm-status"></div>

                <form id="settingsForm" onsubmit="saveSettings(event)">

                    <!-- Integrations -->
                    <div class="mcmm-panel">
                        <h3 class="mcmm-panel-title">üîó Integrations</h3>
                        <div class="mcmm-form-group">
                            <label class="mcmm-label">CurseForge API Key</label>
                            <div style="display: flex; gap: 0.75rem; align-items: center;">
                                <span style="font-size: 1.4rem;">üîë</span>
                                <input type="text" id="curseforge_api_key" class="mcmm-input" placeholder="Enter your API Key..." autocomplete="off" style="flex: 1;" value="<?php echo htmlspecialchars($config['curseforge_api_key']); ?>">
                            </div>
                            <div class="mcmm-input-hint">Required to browse and download modpacks from CurseForge.</div>
                        </div>
                    </div>

                    <!-- Server Configuration -->
                    <div class="mcmm-panel">
                        <h3 class="mcmm-panel-title">‚öôÔ∏è Server Configuration</h3>
                        <div class="mcmm-form-grid">
                            <div class="mcmm-form-group">
                                <label class="mcmm-label">Default Server Name</label>
                                <input type="text" id="default_server_name" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_server_name']); ?>">
                            </div>
                            <div class="mcmm-form-group">
                                <label class="mcmm-label">Default Port</label>
                                <input type="number" id="default_port" class="mcmm-input" value="<?php echo $config['default_port']; ?>">
                            </div>
                            <div class="mcmm-form-group">
                                <label class="mcmm-label">Default Whitelist</label>
                                <input type="text" id="default_whitelist" class="mcmm-input" placeholder="User1, User2..." value="<?php echo htmlspecialchars($config['default_whitelist']); ?>">
                            </div>
                            <div class="mcmm-form-group">
                                <label class="mcmm-label">Default Icon URL</label>
                                <input type="text" id="default_icon_url" class="mcmm-input" placeholder="https://..." value="<?php echo htmlspecialchars($config['default_icon_url']); ?>">
                            </div>
                            <div class="mcmm-form-group">
                                <label class="mcmm-label">Default Max Players</label>
                                <input type="number" id="default_max_players" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_max_players']); ?>">
                            </div>
                        </div>
                    </div>

                    <!-- Performance -->
                    <div class="mcmm-panel">
                        <h3 class="mcmm-panel-title">üöÄ Performance Tuning</h3>
                        <div class="mcmm-form-grid">
                            <div class="mcmm-form-group">
                                <label class="mcmm-label">Default Memory</label>
                                <input type="text" id="default_memory" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_memory']); ?>">
                                <div class="mcmm-ram-presets">
                                    <?php foreach (['4G', '6G', '8G', '10G', '12G'] as $ram) : ?>
                                        <div class="mcmm-ram-pill <?php echo $config['default_memory'] == $ram ? 'active' : ''; ?>" onclick="setRam('<?php echo $ram; ?>')"><?php echo $ram; ?></div>
                                    <?php endforeach; ?>
                                </div>
                            </div>
                        </div>
                        <div class="mcmm-form-group" style="margin-top: 1.5rem;">
                            <label class="mcmm-label">JVM Flags</label>
                            <textarea id="jvm_flags" class="mcmm-input" style="height: 80px; resize: vertical; font-family: 'Fira Code', monospace; font-size: 0.85rem;" placeholder="-XX:+UseG1GC ..."><?php echo htmlspecialchars($config['jvm_flags']); ?></textarea>
                        </div>

                        <div style="margin-top: 1.5rem;">
                            <div class="mcmm-section-title">‚ö° Optimization Flags</div>
                            <div class="mcmm-toggle-grid">
                                <div class="mcmm-toggle-item">
                                    <div class="mcmm-toggle-label">
                                        <span class="mcmm-toggle-name">Aikar's Flags</span>
                                        <span class="mcmm-toggle-desc">JVM optimization</span>
                                    </div>
                                    <label class="mcmm-switch">
                                        <input type="checkbox" id="default_aikar_flags" <?php echo $config['default_aikar_flags'] ? 'checked' : ''; ?>>
                                        <span class="mcmm-slider"></span>
                                    </label>
                                </div>
                                <div class="mcmm-toggle-item">
                                    <div class="mcmm-toggle-label">
                                        <span class="mcmm-toggle-name">Meowice Flags</span>
                                        <span class="mcmm-toggle-desc">Server optimization</span>
                                    </div>
                                    <label class="mcmm-switch">
                                        <input type="checkbox" id="default_meowice_flags" <?php echo $config['default_meowice_flags'] ? 'checked' : ''; ?>>
                                        <span class="mcmm-slider"></span>
                                    </label>
                                </div>
                                <div class="mcmm-toggle-item">
                                    <div class="mcmm-toggle-label">
                                        <span class="mcmm-toggle-name">GraalVM Flags</span>
                                        <span class="mcmm-toggle-desc">GC settings</span>
                                    </div>
                                    <label class="mcmm-switch">
                                        <input type="checkbox" id="default_graalvm_flags" <?php echo $config['default_graalvm_flags'] ? 'checked' : ''; ?>>
                                        <span class="mcmm-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gameplay -->
                    <div class="mcmm-panel">
                        <h3 class="mcmm-panel-title">üéÆ Gameplay & Server Settings</h3>

                        <div class="mcmm-section-title">üéÆ Gameplay Settings</div>
                        <div class="mcmm-toggle-grid">
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">Hardcore Mode</span>
                                    <span class="mcmm-toggle-desc">Permanent death</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_hardcore" <?php echo $config['default_hardcore'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">Allow Flight</span>
                                    <span class="mcmm-toggle-desc">Flight permissions</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_allow_flight" <?php echo $config['default_allow_flight'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">PVP</span>
                                    <span class="mcmm-toggle-desc">Player combat</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_pvp" <?php echo $config['default_pvp'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">Command Blocks</span>
                                    <span class="mcmm-toggle-desc">Enable command blocks</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_command_blocks" <?php echo $config['default_command_blocks'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="mcmm-section-title" style="margin-top: 1.5rem;">üìã Logging & Console</div>
                        <div class="mcmm-toggle-grid">
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">Rolling Logs</span>
                                    <span class="mcmm-toggle-desc">Log rotation</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_rolling_logs" <?php echo $config['default_rolling_logs'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">Log Timestamp</span>
                                    <span class="mcmm-toggle-desc">Timestamps</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_log_timestamp" <?php echo $config['default_log_timestamp'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                            <div class="mcmm-toggle-item">
                                <div class="mcmm-toggle-label">
                                    <span class="mcmm-toggle-name">Direct Console</span>
                                    <span class="mcmm-toggle-desc">Console access</span>
                                </div>
                                <label class="mcmm-switch">
                                    <input type="checkbox" id="default_direct_console" <?php echo $config['default_direct_console'] ? 'checked' : ''; ?>>
                                    <span class="mcmm-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="mcmm-settings-footer">
                        <button type="submit" class="mcmm-btn mcmm-btn-primary" style="padding: 1rem 3rem; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px;">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Deploy Modal -->
    <div class="mcmm-modal-overlay" id="deployModal">
        <div class="mcmm-modal" style="max-width: 300px; width: 50%;">
            <div class="mcmm-modal-header">
                <div>
                    <div class="mcmm-modal-title" id="deployTitle">Deploy Server</div>
                    <div style="color: var(--text-secondary); margin-top: 0.25rem;" id="deploySubtitle"></div>
                </div>
                <button class="mcmm-modal-close" onclick="closeDeploy()">√ó</button>
            </div>

            <div class="mcmm-modal-body" style="display: grid; gap: 1rem; padding: 1.25rem;">
                <div>
                    <label class="mcmm-label">Server Name</label>
                    <input type="text" id="deploy_name" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_server_name']); ?>">
                </div>

                <div class="mcmm-form-group">
                    <label class="mcmm-label">Modpack Version</label>
                    <div id="deployVersionList" style="max-height: 220px; overflow-y: auto; display: grid; gap: 0.5rem; border: 1px solid var(--border); border-radius: 10px; padding: 0.75rem; background: rgba(255,255,255,0.02);">
                        <!-- version buttons injected -->
                    </div>
                    <div id="deployVersionStatus" style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.4rem;">Loading versions...</div>
                    <input type="hidden" id="deploy_version" value="">
                    <input type="hidden" id="deploy_java_version" value="">
                    <input type="hidden" id="deploy_mc_version" value="">
                    <input type="hidden" id="deploy_loader" value="">
                </div>

                <div class="mcmm-form-group">
                    <label class="mcmm-label">Deploy Console</label>
                    <div id="deployConsole" style="display:none; background:#0f1014; border:1px solid var(--border); border-radius:10px; padding:0.75rem; max-height:200px; overflow-y:auto; font-family:'Fira Code', monospace; font-size:0.85rem; color:#c0caf5; white-space:pre-wrap; word-break:break-word;">
                        <div id="deployConsoleText"></div>
                    </div>
                </div>

                <div class="mcmm-form-grid">
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Server IP</label>
                        <input type="text" id="deploy_ip" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_ip']); ?>">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Port</label>
                        <input type="number" id="deploy_port" class="mcmm-input" value="<?php echo $config['default_port']; ?>">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Memory</label>
                        <input type="text" id="deploy_memory" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_memory']); ?>">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Max Players</label>
                        <input type="number" id="deploy_max_players" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_max_players']); ?>">
                    </div>
                </div>

                <div class="mcmm-form-grid">
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Whitelist Users</label>
                        <input type="text" id="deploy_whitelist" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_whitelist']); ?>" placeholder="user1, user2">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Server Icon URL</label>
                        <input type="text" id="deploy_icon_url" class="mcmm-input" value="<?php echo htmlspecialchars($config['default_icon_url']); ?>" placeholder="https://...">
                    </div>
                </div>

                <div class="mcmm-toggle-grid">
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">PVP</span>
                            <span class="mcmm-toggle-desc">Enable player combat</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_pvp" <?php echo $config['default_pvp'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Hardcore</span>
                            <span class="mcmm-toggle-desc">Permanent death</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_hardcore" <?php echo $config['default_hardcore'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Allow Flight</span>
                            <span class="mcmm-toggle-desc">Permit flying in survival</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_allow_flight" <?php echo $config['default_allow_flight'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Command Blocks</span>
                            <span class="mcmm-toggle-desc">Enable command blocks</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_command_blocks" <?php echo $config['default_command_blocks'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Rolling Logs</span>
                            <span class="mcmm-toggle-desc">Rotate logs automatically</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_rolling_logs" <?php echo $config['default_rolling_logs'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Log Timestamp</span>
                            <span class="mcmm-toggle-desc">Add time to logs</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_log_timestamp" <?php echo $config['default_log_timestamp'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Aikar Flags</span>
                            <span class="mcmm-toggle-desc">Use Aikar JVM tuning</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_aikar_flags" <?php echo $config['default_aikar_flags'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Meowice Flags</span>
                            <span class="mcmm-toggle-desc">Extra JVM tweaks</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_meowice_flags" <?php echo $config['default_meowice_flags'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">GraalVM</span>
                            <span class="mcmm-toggle-desc">Use GraalVM JDK</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="deploy_graalvm_flags" <?php echo $config['default_graalvm_flags'] ? 'checked' : ''; ?>>
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="mcmm-form-group">
                    <label class="mcmm-label">JVM Flags</label>
                    <textarea id="deploy_jvm_flags" class="mcmm-input" style="height: 70px; resize: vertical; font-family: 'Fira Code', monospace; font-size: 0.85rem;"><?php echo htmlspecialchars($config['jvm_flags']); ?></textarea>
                </div>

                <div id="deployStatus" class="mcmm-status" style="display: none;"></div>
            </div>

            <div class="mcmm-settings-footer" style="padding: 0 1.25rem 1.25rem;">
                <button type="button" class="mcmm-btn" style="margin-right: auto;" onclick="closeDeploy()">Cancel</button>
                <button type="button" class="mcmm-btn mcmm-btn-primary" onclick="submitDeploy()">Deploy</button>
            </div>
        </div>
    </div>

    <!-- Deploy Progress Modal -->
    <div class="mcmm-modal-overlay" id="deployProgressModal">
        <div class="mcmm-modal" style="max-width: 1100px; width: 96%; height: 90vh;">
            <div class="mcmm-modal-header">
                <div>
                    <div class="mcmm-modal-title">Deployment Progress</div>
                    <div style="color: var(--text-secondary); margin-top: 0.25rem;" id="deployProgressSubtitle">Starting...</div>
            </div>
                <button class="mcmm-modal-close" onclick="closeDeployProgress()">√ó</button>
            </div>

            <div class="mcmm-modal-body" style="display: grid; gap: 1rem; padding: 1rem; grid-template-rows: auto auto 1fr;">
                <div id="deploySteps" style="display: grid; gap: 0.5rem;">
                    <div class="deploy-step" data-step="submit" style="padding: 0.75rem 1rem; border:1px solid var(--border); border-radius:10px; display:flex; align-items:center; gap:0.75rem;">
                        <span class="step-dot" style="width:12px;height:12px;border-radius:50%;background:var(--warning);"></span>
                        <div>
                            <div style="font-weight:700;">Submitting deployment</div>
                            <div class="step-desc" style="color:var(--text-secondary); font-size:0.85rem;">Waiting for API response</div>
        </div>
                        <div class="step-status" style="margin-left:auto; color:var(--text-secondary); font-weight:600;">Pending</div>
                    </div>
                    <div class="deploy-step" data-step="create" style="padding: 0.75rem 1rem; border:1px solid var(--border); border-radius:10px; display:flex; align-items:center; gap:0.75rem;">
                        <span class="step-dot" style="width:12px;height:12px;border-radius:50%;background:var(--border);"></span>
                        <div>
                            <div style="font-weight:700;">Creating container</div>
                            <div class="step-desc" style="color:var(--text-secondary); font-size:0.85rem;">docker run</div>
                        </div>
                        <div class="step-status" style="margin-left:auto; color:var(--text-secondary); font-weight:600;">Pending</div>
                    </div>
                    <div class="deploy-step" data-step="start" style="padding: 0.75rem 1rem; border:1px solid var(--border); border-radius:10px; display:flex; align-items:center; gap:0.75rem;">
                        <span class="step-dot" style="width:12px;height:12px;border-radius:50%;background:var(--border);"></span>
                        <div>
                            <div style="font-weight:700;">Starting server</div>
                            <div class="step-desc" style="color:var(--text-secondary); font-size:0.85rem;">Watching container logs</div>
                        </div>
                        <div class="step-status" style="margin-left:auto; color:var(--text-secondary); font-weight:600;">Pending</div>
    </div>
</div>

                <div>
                    <div style="font-weight:700; margin-bottom:0.5rem;">Live Console</div>
                    <div id="deployProgressConsole" style="background:#0f1014; border:1px solid var(--border); border-radius:10px; padding:0.75rem; height:60vh; max-height:60vh; overflow-y:auto; font-family:'Fira Code', monospace; font-size:0.9rem; color:#c0caf5; white-space:pre-wrap; word-break:break-word;">
                        <div id="deployProgressConsoleText">Waiting for logs...</div>
                    </div>
                </div>
            </div>

            <div class="mcmm-settings-footer" style="padding: 0 1.25rem 1.25rem; gap: 0.5rem;">
                <button type="button" class="mcmm-btn" onclick="closeDeployProgress()">Close</button>
                <button type="button" class="mcmm-btn mcmm-btn-primary" id="deployProgressViewBtn" style="display:none;" onclick="finishDeployAndView()">View Server</button>
            </div>
        </div>
    </div>

    <!-- Mod Manager Modal -->
    <div class="mcmm-modal-overlay" id="modManagerModal">
        <div class="mcmm-modal" style="max-width: 95vw; width: 1600px; height: 90vh; display: flex; flex-direction: column;">
            <!-- Header -->
            <div class="mcmm-modal-header" style="border-bottom: none; padding-bottom: 0;">
                <div>
                    <div class="mcmm-modal-title">Mod Manager</div>
                    <div style="color: var(--text-secondary); margin-top: 0.25rem;" id="modManagerSubtitle"></div>
            </div>
                <button class="mcmm-modal-close" onclick="closeModManager()">√ó</button>
            </div>

            <!-- Search Row -->
            <div style="padding: 1rem 1.5rem 0.5rem; display: flex; gap: 1rem; align-items: center;">
                <div class="mcmm-search" style="flex: 1; max-width: none;">
                    <span class="mcmm-search-icon">üîç</span>
                    <input type="text" class="mcmm-search-input" placeholder="Search for mods..." id="modSearchInput" onkeyup="filterMods()">
        </div>

                <!-- Sort Selector (custom dropdown) -->
                <div id="modSortSelector" style="min-width: 220px;">
                    <div class="mcmm-select" id="modSortSelect" data-target="mod_sort_value">
                        <div class="mcmm-select-trigger" onclick="toggleSelect('modSortSelect')">Sort: Popular</div>
                        <div class="mcmm-select-options">
                            <div class="mcmm-option selected" onclick="selectOption('modSortSelect', 'popular', 'Sort: Popular'); setModSort('popular');">Popular</div>
                            <div class="mcmm-option" onclick="selectOption('modSortSelect', 'downloads', 'Sort: Downloads'); setModSort('downloads');">Downloads</div>
                            <div class="mcmm-option" onclick="selectOption('modSortSelect', 'name', 'Sort: Name (A‚ÄìZ)'); setModSort('name');">Name (A‚ÄìZ)</div>
                            <div class="mcmm-option" onclick="selectOption('modSortSelect', 'name_desc', 'Sort: Name (Z‚ÄìA)'); setModSort('name_desc');">Name (Z‚ÄìA)</div>
                            <div class="mcmm-option" onclick="selectOption('modSortSelect', 'author', 'Sort: Author (A‚ÄìZ)'); setModSort('author');">Author (A‚ÄìZ)</div>
                        </div>
                        <input type="hidden" id="mod_sort_value" value="popular">
                    </div>
                </div>
</div>

            <!-- Toolbar Row -->
            <div style="padding: 0 1.5rem 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border);">
                <!-- Tabs -->
                <div class="mcmm-tabs" style="margin: 0; border: none; padding: 0; width: auto;">
                    <button class="mcmm-tab active" onclick="switchModTab('all', this)">All Mods</button>
                    <button class="mcmm-tab" onclick="switchModTab('installed', this)">Installed</button>
                    <button class="mcmm-tab" onclick="switchModTab('updates', this)">Updates</button>
                </div>

                <!-- Active Filter Display -->
                <div id="activeFilterContainer" style="display: none; align-items: center; gap: 0.5rem; background: rgba(157, 78, 221, 0.1); padding: 0.4rem 0.8rem; border-radius: 6px; border: 1px solid var(--primary-dim); cursor: pointer;" onclick="changeModFilterVersion()" title="Click to manually change version filter">
                    <span style="font-size: 0.85rem; color: var(--primary-hover); font-weight: 600;" id="activeFilterText">Filtering: Detect...</span>
                    <!-- Close button stays for clearing filter -->
                    <button onclick="event.stopPropagation(); clearModFilters()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1rem; padding: 0; line-height: 1; margin-left: 0.3rem;" title="Clear Filter">√ó</button>
                </div>

                <!-- Source Toggle -->
                <div class="mcmm-source-toggle">
                    <button class="mcmm-source-btn active" onclick="switchSource('curseforge', this)">CurseForge</button>
                    <button class="mcmm-source-btn" onclick="switchSource('modrinth', this)">Modrinth</button>
                </div>
            </div>

            <!-- List -->
            <div class="mcmm-modal-body" style="padding: 0; flex: 1; overflow: hidden; display: flex; position: relative;">
                <div id="modList" style="padding: 1.5rem; height: 100%; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.25rem; align-content: start; flex: 1; min-width: 0;">
                    <!-- Mods injected here -->
                </div>

                <!-- Pagination (bottom-center) -->
                <div id="modsPaginationBar" class="mcmm-pagination-bar"></div>

                <!-- Queue Panel (Popout) -->
                <div id="modQueuePanel" class="mcmm-queue-panel">
                    <div class="mcmm-queue-header">
                        <div style="font-weight: 700; font-size: 1.1rem;">Installation Queue</div>
                        <button class="mcmm-btn-icon danger" onclick="clearQueue()" style="width: 32px; height: 32px; font-size: 0.9rem;" title="Clear Queue">üóëÔ∏è</button>
                </div>
                    <div style="padding: 0 1.25rem 0.5rem; color: var(--text-secondary); font-size: 0.85rem; border-bottom: 1px solid var(--border);">
                        <span id="queueCount">0 items</span>
            </div>
                    <div id="queueList" class="mcmm-queue-list">
                        <!-- Queue items -->
                    </div>
                    <div class="mcmm-queue-footer">
                        <button id="btnInstallSelected" class="mcmm-btn mcmm-btn-primary" onclick="installSelectedMods()" style="width: 100%; justify-content: center;">
                            Install Selected
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Server Settings Modal -->
    <div class="mcmm-modal-overlay" id="serverSettingsModal">
        <div class="mcmm-modal" style="max-width: 720px;">
            <div class="mcmm-modal-header">
                <div>
                    <div class="mcmm-modal-title" id="serverSettingsTitle">Server Settings</div>
                    <div style="color: var(--text-secondary); margin-top: 0.25rem;">Edit configuration</div>
                </div>
                <button class="mcmm-modal-close" onclick="closeServerSettings()">√ó</button>
            </div>

            <div class="mcmm-modal-body" style="display: grid; gap: 1rem; padding: 1.25rem;">
                <input type="hidden" id="edit_server_id">

                <div class="mcmm-form-grid">
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Server IP</label>
                        <input type="text" id="edit_ip" class="mcmm-input">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Port</label>
                        <input type="number" id="edit_port" class="mcmm-input">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Memory</label>
                        <input type="text" id="edit_memory" class="mcmm-input">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Max Players</label>
                        <input type="number" id="edit_max_players" class="mcmm-input">
                    </div>
                </div>

                <div class="mcmm-form-grid">
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Whitelist Users</label>
                        <input type="text" id="edit_whitelist" class="mcmm-input" placeholder="user1, user2">
                    </div>
                    <div class="mcmm-form-group">
                        <label class="mcmm-label">Server Icon URL</label>
                        <input type="text" id="edit_icon_url" class="mcmm-input" placeholder="https://...">
                        <div id="edit_icon_preview" style="margin-top: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width:48px; height:48px; border:1px solid var(--border); border-radius:10px; background: rgba(255,255,255,0.04); display:flex; align-items:center; justify-content:center; color: var(--text-muted); font-size:0.8rem;">No Image</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">Preview</div>
                        </div>
                    </div>
                </div>

                <div class="mcmm-toggle-grid">
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">PVP</span>
                </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_pvp">
                            <span class="mcmm-slider"></span>
                        </label>
            </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Hardcore</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_hardcore">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Allow Flight</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_allow_flight">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Command Blocks</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_command_blocks">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Rolling Logs</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_rolling_logs">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Log Timestamp</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_log_timestamp">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Aikar Flags</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_aikar_flags">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">Meowice Flags</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_meowice_flags">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                    <div class="mcmm-toggle-item">
                        <div class="mcmm-toggle-label">
                            <span class="mcmm-toggle-name">GraalVM</span>
                        </div>
                        <label class="mcmm-switch">
                            <input type="checkbox" id="edit_graalvm_flags">
                            <span class="mcmm-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="mcmm-form-group">
                    <label class="mcmm-label">JVM Flags</label>
                    <textarea id="edit_jvm_flags" class="mcmm-input" style="height: 70px; resize: vertical; font-family: 'Fira Code', monospace; font-size: 0.85rem;"></textarea>
                </div>

                <div id="editStatus" class="mcmm-status" style="display: none;"></div>

                <div style="font-size: 0.8rem; color: var(--warning); padding: 0.5rem; border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 6px; background: rgba(251, 191, 36, 0.05);">
                    Note: Saving changes will restart the server.
                </div>
            </div>

            <div class="mcmm-settings-footer" style="padding: 0 1.25rem 1.25rem;">
                <button type="button" class="mcmm-btn" style="margin-right: auto;" onclick="closeServerSettings()">Cancel</button>
                <button type="button" class="mcmm-btn mcmm-btn-primary" onclick="submitServerSettings()">Save & Restart</button>
                </div>
            </div>
    </div>

    <!-- Console Modal -->
    <div class="mcmm-modal-overlay" id="consoleModal">
        <div class="mcmm-modal" style="height: 80vh;">
            <div class="mcmm-modal-header">
                <div class="mcmm-modal-title" id="consoleTitle">Server Console</div>
                <button class="mcmm-modal-close" onclick="closeConsole()">√ó</button>
            </div>
            <div class="mcmm-console-output" id="consoleOutput"></div>
            <div class="mcmm-console-input-container">
                <span class="mcmm-console-prompt">&gt;_</span>
                <input type="text" class="mcmm-console-input" id="consoleInput" placeholder="Send command...">
            </div>
        </div>
    </div>

    <!-- Players Modal -->
    <div class="mcmm-modal-overlay" id="playersModal">
        <div class="mcmm-modal" style="max-width: 540px; width: 95%; display: flex; flex-direction: column;">
            <div class="mcmm-modal-header">
                <div>
                    <div class="mcmm-modal-title">Players</div>
                    <div style="color: var(--text-secondary); margin-top: 0.25rem;" id="playersModalSubtitle"></div>
                </div>
                <button class="mcmm-modal-close" onclick="closePlayersModal()">√ó</button>
            </div>
            <div id="playersBody" class="mcmm-modal-body" style="padding: 0.5rem 0.25rem; max-height: 65vh; overflow: auto;">
                <div style="text-align:center; padding: 2rem; color: var(--text-secondary);">
                    <div class="mcmm-spinner"></div>
                    <div style="margin-top:0.5rem;">Loading players...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Version Selection Modal -->
    <div class="mcmm-modal-overlay" id="versionSelectModal" style="z-index: 2000;">
        <div class="mcmm-modal" style="max-width: 600px; max-height: 80vh; display: flex; flex-direction: column;">
            <div class="mcmm-modal-header">
                <div>
                    <div class="mcmm-modal-title">Select Version</div>
                    <div style="color: var(--text-secondary); margin-top: 0.25rem;" id="versionSelectSubtitle"></div>
                </div>
                <button class="mcmm-modal-close" onclick="closeVersionSelect()">√ó</button>
            </div>
            <div id="versionListContainer" class="mcmm-modal-body" style="overflow-y: auto; padding: 0;">
                <!-- Versions loaded here -->
            </div>
            <div class="mcmm-settings-footer" style="padding: 1.25rem;">
                <button type="button" class="mcmm-btn" style="margin-right: auto;" onclick="closeVersionSelect()">Cancel</button>
                <button type="button" class="mcmm-btn mcmm-btn-primary" id="btnConfirmVersion" onclick="confirmVersionInstall()" disabled>Install Selected</button>
            </div>
        </div>
    </div>
</div>

<script>
    const mcmmConfig = <?php echo json_encode($clientConfig); ?>;
    // @phpstan-ignore-next-line
    const csrfToken = "<?php echo $var['csrf_token'] ?? ''; ?>";
</script>
<script src="/plugins/mcmm/javascript/mcmm.js?v=<?php echo time(); ?>"></script>
</body>
</html>
